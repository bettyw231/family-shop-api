<!DOCTYPE html>
<html lang="ti">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>·ãµ·ä≥·äï ·äì·ã≠ ·ä£·ã∞·ã≠</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Arial, sans-serif;
        }

        body {
            background: #f0f2f5;
            padding: 15px;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
        }
        .header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;

        }
        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }
        .status {
            background: #34495e;
            padding: 8px;
            border-radius: 10px;
            font-size: 14px;
            margin-top: 10px;

        }
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        .menu-btn {
            background: white;
            border: none;

            padding: 25px 10px;
            border-radius: 15px;
            font-size: 18px;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            cursor: pointer;

            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            border-bottom: 4px solid;
        }
        .menu-btn .icon { font-size: 30px; }
        .btn-green { border-bottom-color: #27ae60; }
        .btn-blue { border-bottom-color: #2980b9; }
        .btn-orange { border-bottom-color: #e67e22; }

        .btn-purple { border-bottom-color: #8e44ad; }        

        .section {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-top: 10px;

        }
        .section.active { display: block; }
        
        .back-btn {
            background: #ecf0f1;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 16px;
            margin-bottom: 20px;
            cursor: pointer;
        }
        

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;

        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }

        .action-btn {
            width: 100%;
            padding: 15px;
            background: #27ae60;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
            margin: 10px 0;
        }

        .item-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid #27ae60;
        }

        .item-name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .item-details {

            font-size: 14px;
            color: #666;
        }

        .warning {
            background: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        
        }

    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üè™ ·ãµ·ä≥·äï ·äì·ã≠ ·ä£·ã∞·ã≠</h1>
            <div class="status" id="connectionStatus">·àù·àµ ·à∞·à≠·â®·à≠ ·ã≠·à´·ä∏·â• ·ä£·àé...</div>
        </div>

        <!-- Main Menu (Home) -->
        <div id="homePage">
            <div class="menu-grid">
                <button class="menu-btn btn-green" onclick="showPage('inventory')">
                    <span class="icon">üì¶</span>
                    ·ä•·â∞·ä∏·ãç·äï
                </button>
                <button class="menu-btn btn-blue" onclick="showPage('customers')">
                    <span class="icon">üë•</span>
                    ·ãì·àö·àç·â≤
                </button>
                <button class="menu-btn btn-orange" onclick="showPage('credit')">
                    <span class="icon">üìù</span>
                    ·àΩ·âÅ·à≠·âì·à≠
                </button>
                <button class="menu-btn btn-purple" onclick="showPage('bottles')">
                    <span class="icon">üçæ</span>
                    ·å•·à≠·àô·ãù
                </button>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <button class="action-btn" style="background: #3498db;" onclick="showPage('addItem')">‚ûï ·àì·ãµ·àΩ ·ä•·â∞·ä∏·ãç·äï</button>
                <button class="action-btn" style="background: #9b59b6;" onclick="showPage('addCustomer')">üë§ ·àì·ãµ·àΩ ·ãì·àö·àç</button>
            </div>
        </div>

        <!-- Inventory Page -->
        <div id="inventoryPage" class="section">
            <button class="back-btn" onclick="goHome()">‚Üê ·â∞·àò·àà·àµ</button>
            <h2>üì¶ ·ä•·â∞·ä∏·ãç·äï ·ãò·àé</h2>
            <button class="action-btn" style="background: #3498db;" onclick="loadInventory()">üîÑ ·ä£·àì·ãµ·àµ</button>
            <div id="inventoryList" class="warning">·ã≠·åΩ·â†·ã©...</div>
        </div>

        <!-- Customers Page -->
        <div id="customersPage" class="section">
            <button class="back-btn" onclick="goHome()">‚Üê ·â∞·àò·àà·àµ</button>
            <h2>üë• ·ãì·àö·àç·â≤</h2>
            <div style="display: flex; gap: 10px; margin: 10px 0;">
                <button class="action-btn" style="background: #27ae60;" onclick="loadCustomers('regular')">·ãà·âµ·à©</button>
                <button class="action-btn" style="background: #e67e22;" onclick="loadCustomers('occasional')">·àì·ã∞ ·åç·ãú</button>
            </div>
            <div id="customersList" class="warning">·ã≠·åΩ·â†·ã©...</div>
        </div>

        <!-- Credit Page -->
        <div id="creditPage" class="section">
            <button class="back-btn" onclick="goHome()">‚Üê ·â∞·àò·àà·àµ</button>
            <h2>üìù ·àΩ·âÅ·à≠·âì·à≠</h2>
            <button class="action-btn" style="background: #e67e22;" onclick="showPage('addCredit')">‚ûï ·àì·ãµ·àΩ ·àΩ·âÅ·à≠·âì·à≠</button>
            <div id="creditList" class="warning">·ã≠·åΩ·â†·ã©...</div>
        </div>

        <!-- Bottles Page -->
        <div id="bottlesPage" class="section">
            <button class="back-btn" onclick="goHome()">‚Üê ·â∞·àò·àà·àµ</button>
            <h2>üçæ ·å•·à≠·àô·ãù</h2>
            <button class="action-btn" style="background: #8e44ad;" onclick="showPage('addBottle')">‚ûï ·àì·ãµ·àΩ</button>
            <div id="bottlesList" class="warning">·ã≠·åΩ·â†·ã©...</div>
        </div>

        <!-- Add Item Page -->
        <div id="addItemPage" class="section">
            <button class="back-btn" onclick="goHome()">‚Üê ·â∞·àò·àà·àµ</button>
            <h2>‚ûï ·àì·ãµ·àΩ ·ä•·â∞·ä∏·ãç·äï</h2>
            <form onsubmit="event.preventDefault(); saveItem();">
                <div class="form-group">
                    <label>·àΩ·àù ·ä•·â∞·ä∏·ãç·äï</label>
                    <input type="text" id="itemName" required>
                </div>

                <div class="form-group">
                    <label>·ãã·åã ·ãù·åà·ãõ·äΩ·ãé (·â•·à≠)</label>
                    <input type="number" id="buyingPrice" step="0.01" required>
                </div>

                <div class="form-group">
                    <label>·ãã·åã ·ä≠·âµ·à∏·å•·ãé (·â•·à≠)</label>
                    <input type="number" id="sellingPrice" step="0.01" required>
                </div>

                <div class="form-group">
                    <label>·ä≠·äï·ã∞·ã≠ ·ä£·àà·ä´?</label>
                    <input type="number" id="stock" required>
                </div>
                <button type="submit" class="action-btn">üíæ ·ä£·àï·åΩ·à≠</button>
            </form>
            <div id="addItemMessage" style="display:none; background:#d4edda; color:#155724; padding:10px; border-radius:5px; margin-top:10px;"></div>
        </div>

        <!-- Add Customer Page -->
        <div id="addCustomerPage" class="section">
            <button class="back-btn" onclick="goHome()">‚Üê ·â∞·àò·àà·àµ</button>
            <h2>‚ûï ·àì·ãµ·àΩ ·ãì·àö·àç</h2>
            <form onsubmit="event.preventDefault(); saveCustomer();">
                <div class="form-group">
                    <label>·àΩ·àù ·ãì·àö·àç</label>
                    <input type="text" id="customerName" required>
                </div>

                <div class="form-group">
                    <label>·âÅ·åΩ·à™ ·â∞·àå·çé·äï</label>
                    <input type="tel" id="customerPhone">
                </div>

                <div class="form-group">
                    <label>·ãì·ã≠·äê·âµ ·ãì·àö·àç</label>
                    <select id="customerType">
                        <option value="regular">·ãà·âµ·à© ·ãù·àΩ·à≠·âï</option>
                        <option value="occasional">·àì·ã∞ ·åç·ãú ·ãù·àΩ·à≠·âï</option>
                    </select>
                </div>
                <button type="submit" class="action-btn">üíæ ·ä£·àï·åΩ·à≠</button>
            </form>
            <div id="addCustomerMessage" style="display:none; background:#d4edda; color:#155724; padding:10px; border-radius:5px; margin-top:10px;"></div>
        </div>

        <!-- Add Credit Page -->
        <div id="addCreditPage" class="section">
            <button class="back-btn" onclick="goHome()">‚Üê ·â∞·àò·àà·àµ</button>
            <h2>‚ûï ·àì·ãµ·àΩ ·àΩ·âÅ·à≠·âì·à≠</h2>
            <form onsubmit="event.preventDefault(); saveCredit();">
                <div class="form-group">
                    <label>·àò·à®·çÖ ·ãì·àö·àç</label>
                    <select id="creditCustomer" required>
                        <option value="">·àù·à®·çÖ...</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>·ä•·äï·â≥·ã≠ ·ä•·ã© ·ãù·ãà·à∞·ã∞?</label>
                    <input type="text" id="creditItem" required>
                </div>

                <div class="form-group">
                    <label>·ä≠·äï·ã∞·ã≠ ·â•·à≠?</label>
                    <input type="number" id="creditAmount" step="0.01" required>
                </div>

                <div class="form-group">
                    <label>·ä≠·à≥·â• ·àò·ãì·àµ ·ä≠·ä∏·çç·àç?</label>

                    <input type="date" id="dueDate">
                
                </div>

                <button type="submit" class="action-btn">üíæ ·ä£·àï·åΩ·à≠</button>
            </form>
            <div id="addCreditMessage" style="display:none; background:#d4edda; color:#155724; padding:10px; border-radius:5px; margin-top:10px;"></div>
        </div>

        <!-- Add Bottle Page -->
        <div id="addBottlePage" class="section">
            <button class="back-btn" onclick="goHome()">‚Üê ·â∞·àò·àà·àµ</button>
            <h2>‚ûï ·å•·à≠·àô·ãù ·ãù·ãà·à∞·ã∞</h2>
            <form onsubmit="event.preventDefault(); saveBottle();">
                <div class="form-group">
                    <label>·àΩ·àù ·ãì·àö·àç</label>
                    <input type="text" id="bottleCustomer" required>
                </div>

                <div class="form-group">
                    <label>·ãì·ã≠·äê·âµ ·å•·à≠·àô·ãù</label>

                    <select id="bottleType">
                    
                        <option value="·â¢·à´">·â¢·à´</option>
                    
                        <option value="·àõ·ã≠">·àõ·ã≠</option>
                    
                        <option value="·ä´·àç·ä•">·ä´·àç·ä•</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>·ä≠·äï·ã∞·ã≠ ·å•·à≠·àô·ãù?</label>
                    <input type="number" id="bottleQuantity" value="1">
                </div>
                <button type="submit" class="action-btn">üíæ ·ä£·àï·åΩ·à≠</button>
            </form>
            <div id="addBottleMessage" style="display:none; background:#d4edda; color:#155724; padding:10px; border-radius:5px; margin-top:10px;"></div>
        </div>
    </div>

    <script>
        // üîß CHANGE THIS TO YOUR RENDER URL
        const API_URL = 'https://family-shop-api.onrender.com/api';

        // Page navigation
        function goHome() {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById('homePage').style.display = 'block';
            checkConnection();
        }

        function showPage(page) {
            document.getElementById('homePage').style.display = 'none';
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            
            const pageId = page + 'Page';
            document.getElementById(pageId).classList.add('active');
            
            // Load data based on page
            if (page === 'inventory') loadInventory();
            if (page === 'customers') loadCustomers('regular');
            if (page === 'credit') loadCredits();
            if (page === 'bottles') loadBottles();
            if (page === 'addCredit') loadCustomerDropdown();
        }

        // Check connection
        async function checkConnection() {
            try {
                const response = await fetch(API_URL + '/stats');
                if (response.ok) {
                    document.getElementById('connectionStatus').innerHTML = '‚úÖ ·â∞·à´·ä∫·â°';
                } else {
                    document.getElementById('connectionStatus').innerHTML = '‚ö†Ô∏è ·àì·àã·çç';
                }
            } catch (error) {
                document.getElementById('connectionStatus').innerHTML = '‚ùå ·ä£·ã≠·â∞·à´·ä∏·â†·äï';
            }
        }

        // Load inventory
        async function loadInventory() {
            const list = document.getElementById('inventoryList');
            list.innerHTML = '·ã≠·åΩ·â†·ã©...';
            list.className = 'warning';
            
            try {
                const response = await fetch(API_URL + '/items');
                const items = await response.json();
                
                if (items.length === 0) {
                    list.innerHTML = '·ä•·â∞·ä∏·ãç·äï ·ã®·àà·äï';
                    return;
                }
                
                let html = '';
                items.forEach(item => {
                    html += `
                        <div class="item-card">
                            <div class="item-name">${item.name}</div>
                            <div class="item-details">
                                <div>üí∞ ·åà·ãõ·äΩ·ãé: ${item.buying_price} ·â•·à≠</div>
                                <div>üíµ ·ä≠·âµ·à∏·å•: ${item.selling_price} ·â•·à≠</div>
                                <div>üì¶ ·ãò·àé·ä´: ${item.stock}</div>
                            </div>
                        </div>
                    `;
                });
                list.innerHTML = html;
                list.className = '';
            } catch (error) {
                list.innerHTML = '·åå·åã: ' + error.message;
            }
        }

        // Load customers
        async function loadCustomers(type) {
            const list = document.getElementById('customersList');
            list.innerHTML = '·ã≠·åΩ·â†·ã©...';
            
            try {
                const response = await fetch(API_URL + '/customers');
                let customers = await response.json();

                if (type !== 'all') {
                    customers = customers.filter(c => c.customer_type === type);
                }
                
                if (customers.length === 0) {
                    list.innerHTML = '·ãì·àö·àç·â≤ ·ã®·àà·ãâ·äï';
                    return;
                }
                
                let html = '';
                customers.forEach(c => {
                    html += `
                        <div class="item-card">
                            <div class="item-name">${c.name}</div>
                            <div class="item-details">
                                <div>üìû ${c.phone || '·ã®·àà·äï'}</div>
                                <div>üí∞ ${c.total_credit || 0} ·â•·à≠</div>
                            </div>
                        </div>
                    `;
                });
                list.innerHTML = html;
            } catch (error) {
                list.innerHTML = '·åå·åã: ' + error.message;
            }
        }

        // Load credits
        async function loadCredits() {
            const list = document.getElementById('creditList');
            list.innerHTML = '·ã≠·åΩ·â†·ã©...';
            
            try {
                const response = await fetch(API_URL + '/credits');
                const credits = await response.json();
                const unpaid = credits.filter(c => !c.paid);
                
                if (unpaid.length === 0) {
                    list.innerHTML = '·àΩ·âÅ·à≠·âì·à≠ ·ã®·àà·äï';
                    return;
                }
                
                let html = '';
                unpaid.forEach(c => {
                    html += `
                        <div class="item-card">
                            <div class="item-name">${c.customer_name || '·ãò·ã≠·çç·àà·å•'}</div>
                            <div class="item-details">
                                <div>üì¶ ${c.item_name}</div>
                                <div>üí∞ ${c.amount} ·â•·à≠</div>
                            </div>
                            <button onclick="markAsPaid(${c.id})" style="margin-top:10px; padding:5px 10px;">‚úì ·ä®·çä·àâ</button>
                        </div>
                    `;
                });
                list.innerHTML = html;
            } catch (error) {
                list.innerHTML = '·åå·åã: ' + error.message;
            }
        }

        // Load bottles
        async function loadBottles() {
            const list = document.getElementById('bottlesList');
            list.innerHTML = '·ã≠·åΩ·â†·ã©...';
            
            try {
                const response = await fetch(API_URL + '/bottles');
                const bottles = await response.json();
                const pending = bottles.filter(b => !b.returned);
                
                if (pending.length === 0) {
                    list.innerHTML = '·å•·à≠·àô·ãù ·ãù·ãà·à∞·ã∞ ·ã®·àà·äï';
                    return;
                }
                
                let html = '';
                pending.forEach(b => {
                    html += `
                        <div class="item-card">
                            <div class="item-name">${b.notes?.replace('Customer: ', '') || '·ãò·ã≠·çç·àà·å•'}</div>
                            <div class="item-details">
                                <div>üçæ ${b.bottle_type}</div>
                                <div>üî¢ ${b.quantity}</div>
                            </div>
                            <button onclick="returnBottle(${b.id})" style="margin-top:10px; padding:5px 10px;">üîÑ ·â∞·àò·àä·à±</button>
                        </div>
                    `;
                });
                list.innerHTML = html;
            } catch (error) {
                list.innerHTML = '·åå·åã: ' + error.message;
            }
        }

        // Load customer dropdown
        async function loadCustomerDropdown() {
            try {
                const response = await fetch(API_URL + '/customers');
                const customers = await response.json();
                
                const select = document.getElementById('creditCustomer');
                select.innerHTML = '<option value="">·àù·à®·çÖ...</option>';
                
                customers.forEach(c => {
                    select.innerHTML += `<option value="${c.id}">${c.name}</option>`;
                });
            } catch (error) {
                console.log('Dropdown error:', error);
            }
        }

        // Save item
        async function saveItem() {
            const item = {
                name: document.getElementById('itemName').value,
                buying_price: parseFloat(document.getElementById('buyingPrice').value),
                selling_price: parseFloat(document.getElementById('sellingPrice').value),
                stock: parseInt(document.getElementById('stock').value)
            };
            
            try {
                const response = await fetch(API_URL + '/items', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(item)
                });
                
                if (response.ok) {
                    const msg = document.getElementById('addItemMessage');
                    msg.innerHTML = '‚úÖ ·â∞·ãà·ã≤·âë!';
                    msg.style.display = 'block';
                    document.getElementById('itemName').value = '';
                    document.getElementById('buyingPrice').value = '';
                    document.getElementById('sellingPrice').value = '';
                    document.getElementById('stock').value = '';
                    
                    setTimeout(() => {
                        msg.style.display = 'none';
                        goHome();
                    }, 1500);
                }
            } catch (error) {
                alert('·àΩ·åã·à´: ' + error.message);
            }
        }

        // Save customer
        async function saveCustomer() {
            const customer = {
                name: document.getElementById('customerName').value,
                phone: document.getElementById('customerPhone').value || null,

                customer_type: document.getElementById('customerType').value
            };
            
            try {
                const response = await fetch(API_URL + '/customers', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(customer)
                });
                
                if (response.ok) {
                    const msg = document.getElementById('addCustomerMessage');
                    msg.innerHTML = '‚úÖ ·â∞·ãà·ã≤·âë!';
                    msg.style.display = 'block';
                    
                    document.getElementById('customerName').value = '';
                    document.getElementById('customerPhone').value = '';
                    
                    setTimeout(() => {
                        msg.style.display = 'none';
                        goHome();
                    }, 1500);
                }
            } catch (error) {
                alert('·àΩ·åã·à´: ' + error.message);
            }
        }

        // Save credit
        async function saveCredit() {
            const customerId = document.getElementById('creditCustomer').value;
            if (!customerId) {
                alert('·ãì·àö·àç ·àù·à®·çÖ!');
                return;
            }
            
            const credit = {
                customer_id: customerId,
                item_name: document.getElementById('creditItem').value,

                amount: parseFloat(document.getElementById('creditAmount').value),
                due_date: document.getElementById('dueDate').value || null
            };
            
            try {
                const response = await fetch(API_URL + '/credits', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(credit)
                });
                
                if (response.ok) {
                    const msg = document.getElementById('addCreditMessage');
                    msg.innerHTML = '‚úÖ ·â∞·ãà·ã≤·âë!';
                    msg.style.display = 'block';
                    
                    document.getElementById('creditItem').value = '';
                    document.getElementById('creditAmount').value = '';
                    document.getElementById('dueDate').value = '';
                    
                    setTimeout(() => {
                        msg.style.display = 'none';
                        goHome();
                    }, 1500);
                }
            } catch (error) {
                alert('·àΩ·åã·à´: ' + error.message);
            }
        }

        // Save bottle
        async function saveBottle() {
            const bottle = {
                customer_id: 1,  // Temporary
                bottle_type: document.getElementById('bottleType').value,
                quantity: parseInt(document.getElementById('bottleQuantity').value) || 1,
                notes: 'Customer: ' + document.getElementById('bottleCustomer').value
            };
            
            try {
                const response = await fetch(API_URL + '/bottles', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(bottle)
                });
                
                if (response.ok) {
                    const msg = document.getElementById('addBottleMessage');
                    msg.innerHTML = '‚úÖ ·â∞·ãà·ã≤·âë!';
                    msg.style.display = 'block';                   
                    document.getElementById('bottleCustomer').value = '';
                    document.getElementById('bottleQuantity').value = '1';                    
                    setTimeout(() => {
                        msg.style.display = 'none';
                        goHome();
                    }, 1500);
                }
            } catch (error) {
                alert('·àΩ·åã·à´: ' + error.message);
            }
        }

        // Mark as paid
        async function markAsPaid(creditId) {
            if (!confirm('·ä®·çä·àâ ·ä•·ã©?')) return;
            
            try {
                await fetch(API_URL + '/credits/' + creditId + '/pay', {method: 'PUT'});
                alert('‚úÖ ·â∞·ä∏·çä·àâ');
                loadCredits();
            } catch (error) {
                alert('·àΩ·åã·à´: ' + error.message);
            }
        }

        // Return bottle
        async function returnBottle(bottleId) {
            if (!confirm('·â∞·àò·àä·à± ·ä•·ã©?')) return;
            
            try {
                await fetch(API_URL + '/bottles/' + bottleId + '/return', {method: 'PUT'});
                alert('‚úÖ ·â∞·àò·àä·à±');
                loadBottles();
            } catch (error) {
                alert('·àΩ·åã·à´: ' + error.message);
            }
        }

        // Start
        window.onload = function() {
            goHome();
        };
    </script>
</body>
</html>