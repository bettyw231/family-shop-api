<!DOCTYPE html>
<html lang="ti">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üè™ ·àù·àï·ã∞·à´ ·àµ·à≠·ãì·âµ ·ãµ·äï·ä≥·äï</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Noto Sans Ethiopic', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #2c786c 0%, #004445 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255,255,255,0.2);
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            color: #f8b500;
        }
        
        .header p {
            font-size: 16px;
            opacity: 0.9;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-top: 5px solid #2c786c;
        }
        
        .stat-card h3 {
            font-size: 24px;
            color: #2c786c;
            margin-bottom: 5px;
        }
        
        .stat-card p {
            color: #666;
            font-size: 14px;
        }
        
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .menu-btn {
            background: white;
            border: none;
            padding: 25px 15px;
            border-radius: 15px;
            font-size: 16px;
            font-weight: 600;
            color: #333;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-top: 5px solid;
        }
        
        .menu-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .menu-btn .icon {
            font-size: 30px;
            margin-bottom: 10px;
        }
        
        .inventory-btn { border-top-color: #4CAF50; }
        .credit-btn { border-top-color: #FF9800; }
        .customers-btn { border-top-color: #2196F3; }
        .add-btn { border-top-color: #9C27B0; }
        .bottles-btn { border-top-color: #FF5722; }
        .reports-btn { border-top-color: #673AB7; }
        
        /* Customer type badges */
        .customer-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .regular { background: #4CAF50; color: white; }
        .occasional { background: #FF9800; color: white; }
        .new { background: #2196F3; color: white; }
        
        /* Payment status */
        .paid { color: #4CAF50; }
        .unpaid { color: #ff4444; }
        .overdue { 
            color: #ff9800;
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            overflow-y: auto;
        }
        
        .modal-content {
            background: white;
            margin: 20px;
            padding: 25px;
            border-radius: 20px;
            max-width: 500px;
            margin: 20px auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            border-bottom: 2px solid #eee;
            padding-bottom: 15px;
        }
        
        .modal-header h2 {
            color: #2c786c;
            font-size: 22px;
        }
        
        .close-btn {
            background: #ff4444;
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 600;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            border-color: #2c786c;
            outline: none;
        }
        
        .submit-btn {
            background: linear-gradient(135deg, #2c786c 0%, #004445 100%);
            color: white;
            border: none;
            padding: 18px;
            width: 100%;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
        }
        
        .submit-btn:hover {
            background: linear-gradient(135deg, #004445 0%, #2c786c 100%);
        }
        
        .item-list {
            margin-top: 20px;
        }
        
        .item-card {
            background: #f8f9fa;
            border-left: 5px solid #2c786c;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 10px;
        }
        
        .item-card h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 18px;
        }
        
        .item-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            font-size: 14px;
            color: #666;
        }
        
        .customer-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .action-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .pay-btn { background: #4CAF50; color: white; }
        .remind-btn { background: #FF9800; color: white; }
        .edit-btn { background: #2196F3; color: white; }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .error {
            color: #ff4444;
            text-align: center;
            padding: 20px;
        }
        
        .success {
            color: #4CAF50;
            text-align: center;
            padding: 10px;
            background: #e8f5e9;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #eee;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }
        
        .tab.active {
            border-bottom-color: #2c786c;
            color: #2c786c;
            font-weight: bold;
        }
        
        @media (max-width: 480px) {
            .menu-grid, .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè™ ·ãì·ã≠·äê·â≥·âµ ·ãµ·ä≥·äï ·àµ·à≠·ãì·âµ</h1>
            <p>·äï·äï·àù·àï·ã∞·à´ ·äï·â•·à®·âµ·ç£ ·àç·âì·àï·äï ·å•·à≠·àô·ãù·äï</p>
            <div id="connectionStatus" style="margin-top: 10px; font-size: 14px;"></div>
        </div>
        
        <div class="stats-grid" id="statsContainer">
            <!-- Stats will load here -->
        </div>
        
        <div class="menu-grid">
            <button class="menu-btn inventory-btn" onclick="openModal('inventoryModal')">
                <span class="icon">üì¶</span>
                ·äï·â•·à®·âµ
            </button>
            <button class="menu-btn credit-btn" onclick="openModal('creditModal')">
                <span class="icon">üìù</span>
                ·àç·âì·àï
            </button>
            <button class="menu-btn customers-btn" onclick="openModal('customersModal')">
                <span class="icon">üë•</span>
                ·ãì·ã≠·äê·â≥·âµ ·ãì·àö·àç
            </button>
            <button class="menu-btn add-btn" onclick="openModal('addItemModal')">
                <span class="icon">‚ûï</span>
                ·äï·â•·à®·âµ ·ãà·àµ·äΩ 
            </button>
            <button class="menu-btn bottles-btn" onclick="openModal('bottlesModal')">
                <span class="icon">üçæ</span>
                ·å•·à≠·àô·ãù ·àù·àï·ã∞·à´
            </button>
            <button class="menu-btn reports-btn" onclick="openModal('reportsModal')">
                <span class="icon">üìä</span>
                ·à™·çñ·à≠·âµ
            </button>
        </div>
        
        <div style="text-align: center; color: white; margin-top: 30px; font-size: 14px; opacity: 0.8;">
            <p>üì± ·ä£·â• ·ä©·àâ ·àû·â£·ã≠·àç ·ã≠·à∞·à≠·àï ‚Ä¢ üíæ ·ä£·ãç·â∂·àõ·â≤·ä≠ ·ã≠·àï·å∏·àù ‚Ä¢ üîÑ ·àï·åÇ ·ãù·ä∏·ãç·äï ·àì·â†·à¨·â≥</p>
        </div>
    </div>
    
    <!-- Add Item Modal -->
    <div id="addItemModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚ûï ·ä£·ãà·ã≤·âï ·ä•·â∞·ä∏·ãç·äï</h2>
                <button class="close-btn" onclick="closeModal('addItemModal')">√ó</button>
            </div>
            <form id="addItemForm" onsubmit="event.preventDefault(); addItem();">
                <div class="form-group">
                    <label>·àµ·àù ·ä•·â∞·ä∏·ãç·äï *</label>
                    <input type="text" id="itemName" required placeholder="·äÆ·ä´-·äÆ·àã 500·àö·àä">
                </div>
                <div class="form-group">
                    <label>·ãã·åã ·ãù·â∞·ä∏·ãç·äê·àâ (·â•·à≠) *</label>
                    <input type="number" id="buyingPrice" step="0.01" required placeholder="80.00">
                </div>
                <div class="form-group">
                    <label>·ãã·åã ·ãù·â∞·à∏·å†·àâ (·â•·à≠) *</label>
                    <input type="number" id="sellingPrice" step="0.01" required placeholder="100.00">
                </div>
                <div class="form-group">
                    <label>·âÅ/·åΩ·à™ ·ä•·â∞·ä∏·ãç·äï *</label>
                    <input type="number" id="stock" required placeholder="24">
                </div>
                <div class="form-group">
                    <label>·ãì·ã≠·äê·âµ</label>
                    <select id="category">
                        <option value="·àõ·ã≠">·àõ·ã≠</option>
                        <option value="·àµ·äí·âÉ">·àµ·äí·âÉ</option>
                        <option value="·åà·àà·åª">·åà·àà·åª</option>
                        <option value="·ä´·àç·ä•">·ä´·àç·ä•</option>
                    </select>
                </div>
                <button type="submit" class="submit-btn">üíæ ·ä£·àï·åΩ·àÆ</button>
                <div id="addItemMessage" class="success" style="display: none;"></div>
            </form>
        </div>
    </div>
    
    <!-- Inventory Modal -->
    <div id="inventoryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üì¶ ·àï·åÇ ·ãò·àé ·ä•·â∞·ä∏·ãç·äï</h2>
                <button class="close-btn" onclick="closeModal('inventoryModal')">√ó</button>
            </div>
            <button class="submit-btn" onclick="loadInventory()" style="margin-bottom: 20px;">
                üîÑ ·ä£·ã∞·àõ·àù·åΩ
            </button>
            <div id="inventoryList" class="loading">
                ·ä•·â∞·ä∏·ãç·äï ·ä•·ã© ·ãù·àò·åΩ·ä•...
            </div>
        </div>
    </div>
    
    <!-- Credit Modal -->
    <div id="creditModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìù ·àΩ·âÅ·à≠·âì·à≠ ·äì·ã≠ ·ãì·àö·àç·â≤</h2>
                <button class="close-btn" onclick="closeModal('creditModal')">√ó</button>
            </div>
            <div class="tabs">
                <div class="tab active" onclick="switchCreditTab('all')">·ä©·àé·àù</div>
                <div class="tab" onclick="switchCreditTab('unpaid')">·ãò·ã≠·â∞·ä∏·çç·àà</div>
                <div class="tab" onclick="switchCreditTab('overdue')">·ãù·àì·àà·çà ·åç·ãú</div>
            </div>
            <button class="submit-btn" onclick="openModal('addCreditModal')" style="margin-bottom: 20px;">
                ‚ûï ·ä£·ãà·ã≤·âï ·àΩ·âÅ·à≠·âì·à≠
            </button>
            <div id="creditList" class="loading">
                ·àΩ·âÅ·à≠·âì·à≠ ·ä•·ã© ·ãù·àò·åΩ·ä•...
            </div>
        </div>
    </div>
    
    <!-- Customers Modal -->
    <div id="customersModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üë• ·ãì·ã≠·äê·â≥·âµ ·ãì·àö·àç·â≤</h2>
                <button class="close-btn" onclick="closeModal('customersModal')">√ó</button>
            </div>
            <div class="tabs">
                <div class="tab active" onclick="switchCustomerTab('regular')">·ãà·âµ·à© ·ãù·àΩ·à≠·âï</div>
                <div class="tab" onclick="switchCustomerTab('occasional')">·àì·ã∞ ·åç·ãú ·ãù·àΩ·à≠·âï</div>
                <div class="tab" onclick="switchCustomerTab('all')">·ä©·àé·àù</div>
            </div>
            <button class="submit-btn" onclick="openModal('addCustomerModal')" style="margin-bottom: 20px;">
                ‚ûï ·ä£·ãà·ã≤·âï ·ãì·àö·àç
            </button>
            <div id="customersList" class="loading">
                ·ãì·àö·àç·â≤ ·ä•·ãÆ·àù ·ãù·àò·åΩ·ä°...
            </div>
        </div>
    </div>
    
    <!-- Add Credit Modal -->
    <div id="addCreditModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üí≥ ·ä£·ãà·ã≤·âï ·àΩ·âÅ·à≠·âì·à≠</h2>
                <button class="close-btn" onclick="closeModal('addCreditModal')">√ó</button>
            </div>
            <form id="addCreditForm" onsubmit="event.preventDefault(); addCredit();">
                <div class="form-group">
                    <label>·àµ·àù ·ãì·àö·àç *</label>
                    <select id="customerSelect" required>
                        <option value="">·àò·à®·çÖ ·ãì·àö·àç...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>·ä•·â∞·ä∏·ãç·äï ·ãù·â∞·à∞·à®·âê *</label>
                    <input type="text" id="creditItem" required placeholder="·ä•·â∞·ä∏·ãç·äï ·àµ·àù">
                </div>
                <div class="form-group">
                    <label>·âÅ·åΩ·à™</label>
                    <input type="number" id="creditQuantity" value="1">
                </div>
                <div class="form-group">
                    <label>·â•·à≠ *</label>
                    <input type="number" id="creditAmount" step="0.01" required placeholder="·â•·à≠">
                </div>
                <div class="form-group">
                    <label>·åç·ãú ·ä≠·ä∏·çç·àç</label>
                    <input type="date" id="dueDate">
                </div>
                <div class="form-group">
                    <label>·ãì·ã≠·äê·âµ ·ãì·àö·àç</label>
                    <select id="customerType">
                        <option value="regular">·ãà·âµ·à© ·ãù·àΩ·à≠·âï</option>
                        <option value="occasional">·àì·ã∞ ·åç·ãú ·ãù·àΩ·à≠·âï</option>
                        <option value="new">·àì·ãµ·àΩ</option>
                    </select>
                </div>
                <button type="submit" class="submit-btn">üíæ ·ä£·àï·åΩ·àÆ</button>
                <div id="addCreditMessage" class="success" style="display: none;"></div>
            </form>
        </div>
    </div>
    
    <!-- Add Customer Modal -->
    <div id="addCustomerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üë§ ·ä£·ãà·ã≤·âï ·ãì·àö·àç</h2>
                <button class="close-btn" onclick="closeModal('addCustomerModal')">√ó</button>
            </div>
            <form id="addCustomerForm" onsubmit="event.preventDefault(); addCustomer();">
                <div class="form-group">
                    <label>·àµ·àù *</label>
                    <input type="text" id="customerName" required placeholder="·àµ·àù ·ãì·àö·àç">
                </div>
                <div class="form-group">
                    <label>·âÅ·åΩ·à™ ·â∞·àå·çé·äï</label>
                    <input type="tel" id="customerPhone" placeholder="·âÅ·åΩ·à™ ·â∞·àå·çé·äï">
                </div>
                <div class="form-group">
                    <label>·ä£·ãµ·à´·àª</label>
                    <input type="text" id="customerAddress" placeholder="·ä£·ãµ·à´·àª">
                </div>
                <div class="form-group">
                    <label>·ãì·ã≠·äê·âµ ·ãì·àö·àç *</label>
                    <select id="customerTypeSelect" required>
                        <option value="regular">·ãà·âµ·à© ·ãù·àΩ·à≠·âï (·ä£·â• ·à∞·àô·äï ·ã≠·àò·åΩ·ä•)</option>
                        <option value="occasional">·àì·ã∞ ·åç·ãú ·ãù·àΩ·à≠·âï</option>
                        <option value="new">·àì·ãµ·àΩ</option>
                    </select>
                </div>
                <button type="submit" class="submit-btn">üíæ ·ä£·àï·åΩ·àÆ</button>
                <div id="addCustomerMessage" class="success" style="display: none;"></div>
            </form>
        </div>
    </div>
    
    <!-- Bottles Modal -->
    <div id="bottlesModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üçæ ·àò·àà·àà·âµ ·å•·à≠·àô·ãù</h2>
                <button class="close-btn" onclick="closeModal('bottlesModal')">√ó</button>
            </div>
            <button class="submit-btn" onclick="openModal('addBottleModal')" style="margin-bottom: 20px;">
                ‚ûï ·å•·à≠·àô·ãù ·ãù·â∞·ãà·à∞·ã∞ ·ä£·àµ·àò·àç·àç
            </button>
            <div id="bottlesList" class="loading">
                ·å•·à≠·àô·ãù ·ä•·ã© ·ãù·àò·åΩ·ä•...
            </div>
        </div>
    </div>
    
    <!-- Reports Modal -->
    <div id="reportsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìä ·à™·çñ·à≠·âµ</h2>
                <button class="close-btn" onclick="closeModal('reportsModal')">√ó</button>
            </div>
            <div class="tabs">
                <div class="tab active" onclick="showReport('summary')">·àì·çà·àª·ãä</div>
                <div class="tab" onclick="showReport('topCustomers')">·âÄ·äï·ã≤ ·ãì·àö·àç·â≤</div>
                <div class="tab" onclick="showReport('overdue')">·ãù·àì·àà·çà ·åç·ãú</div>
            </div>
            <div id="reportContent" class="loading">
                ·à™·çñ·à≠·âµ ·ä•·ã© ·ãù·àò·åΩ·ä•...
            </div>
        </div>
    </div>

    <script>
        // CHANGE THIS TO YOUR RENDER URL
        const API_URL = 'https://family-shop-api.onrender.com/api';
        let currentCreditTab = 'all';
        let currentCustomerTab = 'regular';
        
        // Check connection on load
        window.onload = function() {
            checkConnection();
            loadStats();
        };
        
        // Check if API is reachable
        async function checkConnection() {
            const statusElement = document.getElementById('connectionStatus');
            try {
                const response = await fetch(`${API_URL}/stats`);
                if (response.ok) {
                    statusElement.innerHTML = '<span style="color:#4CAF50;">‚úì ·à∞·à≠·â®·à≠ ·àù·àâ·ä• ·â•·àù·àâ·ä• ·â∞·à∞·à™·àë</span>';
                } else {
                    statusElement.innerHTML = '<span style="color:#ff9800;">‚ö†Ô∏è ·ä£·â• ·à∞·à≠·â®·à≠ ·åå·åã ·ä£·àé</span>';
                }
            } catch (error) {
                statusElement.innerHTML = '<span style="color:#ff4444;">‚úó ·àù·àµ ·à∞·à≠·â®·à≠ ·àù·âµ·ä•·àµ·à≥·à≠ ·ä£·ã≠·ä®·ä£·àà·äï</span>';
                console.log('Server URL:', API_URL);
            }
        }
        
        // Modal functions
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
            if (modalId === 'inventoryModal') loadInventory();
            if (modalId === 'creditModal') loadCredits();
            if (modalId === 'customersModal') loadCustomers();
            if (modalId === 'bottlesModal') loadBottles();
            if (modalId === 'reportsModal') showReport('summary');
            if (modalId === 'addCreditModal') loadCustomerSelect();
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        // Load dashboard stats
        async function loadStats() {
            try {
                const response = await fetch(`${API_URL}/stats`);
                const stats = await response.json();
                
                document.getElementById('statsContainer').innerHTML = `
                    <div class="stat-card">
                        <h3>${stats.total_items}</h3>
                        <p>·ä•·â∞·ä∏·ãç·äï</p>
                    </div>
                    <div class="stat-card">
                        <h3>${stats.total_customers}</h3>
                        <p>·ãì·àö·àç·â≤</p>
                    </div>
                    <div class="stat-card">
                        <h3>${stats.pending_credits}</h3>
                        <p>·àΩ·âÅ·à≠·âì·à≠</p>
                    </div>
                    <div class="stat-card">
                        <h3>${stats.pending_bottles}</h3>
                        <p>·å•·à≠·àô·ãù</p>
                    </div>
                `;
            } catch (error) {
                document.getElementById('statsContainer').innerHTML = `
                    <div class="error">
                        <p>·àµ·â≥·âµ·àµ ·ä≠·àò·åΩ·ä• ·ä£·ã≠·ä®·ä£·àà·äï·ç¢ ·à∞·à≠·â®·à≠ ·à≠·ä†·ç¢</p>
                    </div>
                `;
            }
        }
        
        // Load inventory items
        async function loadInventory() {
            try {
                const response = await fetch(`${API_URL}/items`);
                const items = await response.json();
                
                const inventoryList = document.getElementById('inventoryList');
                
                if (items.length === 0) {
                    inventoryList.innerHTML = '<p style="text-align:center;color:#666;">·ä•·â∞·ä∏·ãç·äï ·ä£·ã≠·â∞·à®·äΩ·â†·äï·ç¢</p>';
                    return;
                }
                
                inventoryList.innerHTML = items.map(item => `
                    <div class="item-card">
                        <h3>${item.name}</h3>
                        <div class="item-details">
                            <div><strong>·ãã·åã ·ä£·â≥·ãä:</strong> ·â•·à≠${item.buying_price}</div>
                            <div><strong>·ãã·åã ·àΩ·ã´·å≠:</strong> ·â•·à≠${item.selling_price}</div>
                            <div><strong>·âÅ·åΩ·à™:</strong> ${item.stock} ·ä≠·çç·àç</div>
                            <div><strong>·ãì·ã≠·äê·âµ:</strong> ${item.category || '·ä´·àç·ä•'}</div>
                        </div>
                        <p><small>·ãù·â∞·àà·ãà·å†: ${new Date(item.last_updated).toLocaleDateString()}</small></p>
                    </div>
                `).join('');
                
            } catch (error) {
                document.getElementById('inventoryList').innerHTML = 
                    '<div class="error">·ä•·â∞·ä∏·ãç·äï ·ä≠·àò·åΩ·ä• ·ä£·ã≠·ä®·ä£·àà·äï·ç¢ ·à∞·à≠·â®·à≠ ·à≠·ä†·ç¢</div>';
            }
        }
        
        // Add new item
        async function addItem() {
            const itemData = {
                name: document.getElementById('itemName').value,
                buying_price: parseFloat(document.getElementById('buyingPrice').value),
                selling_price: parseFloat(document.getElementById('sellingPrice').value),
                stock: parseInt(document.getElementById('stock').value),
                category: document.getElementById('category').value
            };
            
            try {
                const response = await fetch(`${API_URL}/items`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(itemData)
                });
                
                if (response.ok) {
                    const message = document.getElementById('addItemMessage');
                    message.textContent = '‚úÖ ·ä•·â∞·ä∏·ãç·äï ·â∞·ãà·ã≤·âë!';
                    message.style.display = 'block';
                    
                    // Clear form
                    document.getElementById('itemName').value = '';
                    document.getElementById('buyingPrice').value = '';
                    document.getElementById('sellingPrice').value = '';
                    document.getElementById('stock').value = '';
                    
                    // Update stats
                    loadStats();
                    
                    // Hide message after 3 seconds
                    setTimeout(() => {
                        message.style.display = 'none';
                        closeModal('addItemModal');
                    }, 2000);
                }
            } catch (error) {
                alert('·àΩ·åã·à´: ' + error.message);
            }
        }
        
        // Switch credit tabs
        function switchCreditTab(tab) {
            currentCreditTab = tab;
            document.querySelectorAll('#creditModal .tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            loadCredits();
        }
        
        // Load credits with filtering
        async function loadCredits() {
            try {
                const response = await fetch(`${API_URL}/credits`);
                let credits = await response.json();
                
                // Filter credits based on current tab
                if (currentCreditTab === 'unpaid') {
                    credits = credits.filter(credit => !credit.paid);
                } else if (currentCreditTab === 'overdue') {
                    const today = new Date();
                    credits = credits.filter(credit => {
                        if (credit.paid) return false;
                        if (!credit.due_date) return false;
                        const dueDate = new Date(credit.due_date);
                        return dueDate < today;
                    });
                }
                
                const creditList = document.getElementById('creditList');
                
                if (credits.length === 0) {
                    creditList.innerHTML = '<p style="text-align:center;color:#666;">·àΩ·âÅ·à≠·âì·à≠ ·ä£·ã≠·â∞·à®·äΩ·â†·äï·ç¢</p>';
                    return;
                }
                
                creditList.innerHTML = credits.map(credit => {
                    const dueDate = credit.due_date ? new Date(credit.due_date) : null;
                    const today = new Date();
                    const isOverdue = dueDate && dueDate < today && !credit.paid;
                    
                    return `
                    <div class="item-card" style="border-left-color: ${credit.paid ? '#4CAF50' : isOverdue ? '#FF9800' : '#2196F3'};">
                        <h3>
                            ${credit.customer_name || '·ãò·ã≠·çç·àà·å• ·ãì·àö·àç'}
                            <span class="customer-badge ${credit.customer_type || 'regular'}">
                                ${credit.customer_type === 'regular' ? '·ãà·âµ·à©' : 
                                  credit.customer_type === 'occasional' ? '·àì·ã∞ ·åç·ãú' : '·àì·ãµ·àΩ'}
                            </span>
                        </h3>
                        <div class="item-details">
                            <div><strong>·ä•·â∞·ä∏·ãç·äï:</strong> ${credit.item_name}</div>
                            <div><strong>·â•·à≠:</strong> ${credit.amount}</div>
                            <div class="${credit.paid ? 'paid' : isOverdue ? 'overdue' : 'unpaid'}">
                                <strong>·ä©·äê·âµ:</strong> ${credit.paid ? '·â∞·ä∏·çä·àâ ‚úì' : isOverdue ? '·ãù·àì·àà·çà ·åç·ãú' : '·ãò·ã≠·â∞·ä∏·çà·àà'}
                            </div>
                            <div><strong>·âÄ·äï:</strong> ${new Date(credit.transaction_date).toLocaleDateString()}</div>
                        </div>
                        ${dueDate ? `<p><strong>·åç·ãú ·ä≠·ä∏·çç·àç:</strong> ${dueDate.toLocaleDateString()}</p>` : ''}
                        ${credit.notes ? `<p><strong>·àõ·àï·â†·à≠:</strong> ${credit.notes}</p>` : ''}
                        
                        ${!credit.paid ? `
                        <div class="customer-actions">
                            <button class="action-btn pay-btn" onclick="markAsPaid(${credit.id})">·ä∏·çä·àç</button>
                            <button class="action-btn remind-btn" onclick="sendReminder(${credit.id})">·ãò·ä≠·à≠</button>
                        </div>
                        ` : ''}
                    </div>
                `}).join('');
                
            } catch (error) {
                document.getElementById('creditList').innerHTML = 
                    '<div class="error">·àΩ·âÅ·à≠·âì·à≠ ·ä≠·àò·åΩ·ä• ·ä£·ã≠·ä®·ä£·àà·äï·ç¢</div>';
            }
        }
        
        // Load customer dropdown for credit form
        async function loadCustomerSelect() {
            try {
                const response = await fetch(`${API_URL}/customers`);
                const customers = await response.json();
                
                const select = document.getElementById('customerSelect');
                select.innerHTML = '<option value="">·àò·à®·çÖ ·ãì·àö·àç...</option>';
                
                customers.forEach(customer => {
                    const option = document.createElement('option');
                    option.value = customer.id;
                    option.textContent = `${customer.name} (${customer.phone || '·ãò·ã≠·â∞·åà·àç·åà·àà'})`;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('Error loading customers:', error);
            }
        }
        
        // Add credit entry
        async function addCredit() {
            const customerSelect = document.getElementById('customerSelect');
            const customerId = customerSelect.value;
            const customerType = document.getElementById('customerType').value;
            
            if (!customerId) {
                alert('·ä£·äï·çà·âµ ·ãì·àö·àç ·àò·à®·çÖ!');
                return;
            }
            
            const creditData = {
                customer_id: customerId,
                item_name: document.getElementById('creditItem').value,
                quantity: parseInt(document.getElementById('creditQuantity').value) || 1,
                amount: parseFloat(document.getElementById('creditAmount').value),
                due_date: document.getElementById('dueDate').value || null,
                notes: `·ãì·ã≠·äê·âµ ·ãì·àö·àç: ${customerType}`
            };
            
            try {
                const response = await fetch(`${API_URL}/credits`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(creditData)
                });
                
                if (response.ok) {
                    const message = document.getElementById('addCreditMessage');
                    message.textContent = '‚úÖ ·àΩ·âÅ·à≠·âì·à≠ ·â∞·ãà·ã≤·âë!';
                    message.style.display = 'block';
                    
                    // Clear form
                    document.getElementById('creditItem').value = '';
                    document.getElementById('creditAmount').value = '';
                    document.getElementById('dueDate').value = '';
                    
                    // Update stats
                    loadStats();
                    
                    setTimeout(() => {
                        message.style.display = 'none';
                        closeModal('addCreditModal');
                        loadCredits();
                    }, 2000);
                }
            } catch (error) {
                alert('·àΩ·åã·à´: ' + error.message);
            }
        }
        
        // Switch customer tabs
        function switchCustomerTab(tab) {
            currentCustomerTab = tab;
            document.querySelectorAll('#customersModal .tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            loadCustomers();
        }
        
        // Load customers with categorization
        async function loadCustomers() {
            try {
                const response = await fetch(`${API_URL}/customers`);
                let customers = await response.json();
                
                // Get credits to count transactions
                const creditsResponse = await fetch(`${API_URL}/credits`);
                const credits = await creditsResponse.json();
                
                // Categorize customers based on transaction frequency
                customers = customers.map(customer => {
                    const customerCredits = credits.filter(c => c.customer_id == customer.id);
                    const creditCount = customerCredits.length;
                    
                    // Determine customer type
                    let customerType = customer.customer_type;
                    if (!customerType) {
                        if (creditCount >= 5) customerType = 'regular';
                        else if (creditCount >= 1) customerType = 'occasional';
                        else customerType = 'new';
                    }
                    
                    const totalOwed = customerCredits
                        .filter(c => !c.paid)
                        .reduce((sum, c) => sum + parseFloat(c.amount || 0), 0);
                    
                    return {
                        ...customer,
                        transaction_count: creditCount,
                        customer_type: customerType,
                        total_owed: totalOwed,
                        last_transaction: customerCredits.length > 0 ? 
                            new Date(Math.max(...customerCredits.map(c => new Date(c.transaction_date)))) : null
                    };
                });
                
                // Filter based on current tab
                if (currentCustomerTab === 'regular') {
                    customers = customers.filter(c => c.customer_type === 'regular');
                } else if (currentCustomerTab === 'occasional') {
                    customers = customers.filter(c => c.customer_type === 'occasional');
                }
                
                // Sort by transaction count (highest first)
                customers.sort((a, b) => b.transaction_count - a.transaction_count);
                
                const customersList = document.getElementById('customersList');
                
                if (customers.length === 0) {
                    customersList.innerHTML = '<p style="text-align:center;color:#666;">·ãì·àö·àç·â≤ ·ä£·ã≠·â∞·à®·äΩ·â°·äï·ç¢</p>';
                    return;
                }
                
                customersList.innerHTML = customers.map(customer => {
                    const typeLabel = customer.customer_type === 'regular' ? '·ãà·âµ·à© ·ãù·àΩ·à≠·âï' :
                                     customer.customer_type === 'occasional' ? '·àì·ã∞ ·åç·ãú ·ãù·àΩ·à≠·âï' : '·àì·ãµ·àΩ';
                    
                    const typeClass = customer.customer_type === 'regular' ? 'regular' :
                                     customer.customer_type === 'occasional' ? 'occasional' : 'new';
                    
                    return `
                    <div class="item-card">
                        <h3>
                            ${customer.name}
                            <span class="customer-badge ${typeClass}">${typeLabel}</span>
                        </h3>
                        <div class="item-details">
                            <div><strong>·â∞·àå·çé·äï:</strong> ${customer.phone || '·ãò·ã≠·â∞·åà·àç·åà·àà'}</div>
                            <div><strong>·â•·ãù·àí ·àΩ·ã´·å≠:</strong> ${customer.transaction_count}</div>
                            <div><strong>·ä≠·çç·àä·âµ ·ãò·àà·ãé:</strong> ·â•·à≠${customer.total_owed.toFixed(2)}</div>
                            <div><strong>·ãù·àì·àà·çà ·àΩ·ã´·å≠:</strong> ${customer.last_transaction ? 
                                customer.last_transaction.toLocaleDateString() : '·ã®·àà·äï'}</div>
                        </div>
                        ${customer.address ? `<p><strong>·ä£·ãµ·à´·àª:</strong> ${customer.address}</p>` : ''}
                        <div class="customer-actions">
                            <button class="action-btn edit-btn" onclick="editCustomer(${customer.id})">·âÄ·ã≠·à≠</button>
                            <button class="action-btn remind-btn" onclick="remindCustomer(${customer.id})">·ãò·ä≠·à≠</button>
                            <button class="action-btn pay-btn" onclick="viewCustomerCredits(${customer.id})">·àΩ·âÅ·à≠·âì·à≠ ·à≠·ä†</button>
                        </div>
                    </div>
                `}).join('');
                
            } catch (error) {
                document.getElementById('customersList').innerHTML = 
                    '<div class="error">·ãì·àö·àç·â≤ ·ä≠·àò·åΩ·ä° ·ä£·ã≠·ä®·ä£·àà·äï·ç¢</div>';
            }
        }
        
        // Add new customer
        async function addCustomer() {
            const customerData = {
                name: document.getElementById('customerName').value,
                phone: document.getElementById('customerPhone').value || null,
                address: document.getElementById('customerAddress').value || null,
                customer_type: document.getElementById('customerTypeSelect').value
            };
            
            try {
                const response = await fetch(`${API_URL}/customers`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(customerData)
                });
                
                if (response.ok) {
                    const message = document.getElementById('addCustomerMessage');
                    message.textContent = '‚úÖ ·ãì·àö·àç ·â∞·ãà·ã≤·âë!';
                    message.style.display = 'block';
                    
                    // Clear form
                    document.getElementById('customerName').value = '';
                    document.getElementById('customerPhone').value = '';
                    document.getElementById('customerAddress').value = '';
                    
                    // Update stats
                    loadStats();
                    
                    setTimeout(() => {
                        message.style.display = 'none';
                        closeModal('addCustomerModal');
                        loadCustomers();
                    }, 2000);
                }
            } catch (error) {
                alert('·àΩ·åã·à´: ' + error.message);
            }
        }
        
        // Mark credit as paid
        async function markAsPaid(creditId) {
            if (!confirm('·ä•·ãö ·àΩ·âÅ·à≠·âì·à≠ ·ä∏·çä·àâ ·ä®·àù ·ãù·â†·àÉ·àç ·à≠·åç·å∏·äõ ·ã≤·äª?')) return;
            
            try {
                const response = await fetch(`${API_URL}/credits/${creditId}/pay`, {
                    method: 'PUT'
                });
                
                if (response.ok) {
                    alert('‚úÖ ·àΩ·âÅ·à≠·âì·à≠ ·ä∏·çä·àâ ·â∞·à∞·äï·ã©!');
                    loadCredits();
                    loadStats();
                }
            } catch (error) {
                alert('·àΩ·åã·à´: ' + error.message);
            }
        }
        
        // Send reminder (simulated)
        function sendReminder(creditId) {
            alert('üì± ·ãò·ä´·à≠·ã´ ·àò·àç·ä•·äΩ·â≤ ·â∞·àç·ä•·äπ! (·â•·àì·çà·àª ·äÆ·ã≠·äë ·ã≠·à∞·à≠·àï)');
            // In real app, you would call an API to send SMS
        }
        
        // Show reports
        async function showReport(type) {
            const reportContent = document.getElementById('reportContent');
            reportContent.innerHTML = '<div class="loading">·à™·çñ·à≠·âµ ·ä•·ã© ·ãù·àò·åΩ·ä•...</div>';
            
            try {
                if (type === 'summary') {
                    const statsResponse = await fetch(`${API_URL}/stats`);
                    const stats = await statsResponse.json();
                    
                    reportContent.innerHTML = `
                        <div class="item-card">
                            <h3>·àì·çà·àª·ãä ·à™·çñ·à≠·âµ</h3>
                            <div class="item-details">
                                <div><strong>·ä†·å†·âì·àã·àã ·ä•·â∞·ä∏·ãç·äï:</strong> ${stats.total_items}</div>
                                <div><strong>·ä†·å†·âì·àã·àã ·ãì·àö·àç·â≤:</strong> ${stats.total_customers}</div>
                                <div><strong>·ãò·ã≠·â∞·ä∏·çç·àà ·àΩ·âÅ·à≠·âì·à≠:</strong> ${stats.pending_credits}</div>
                                <div><strong>·ãò·ã≠·â∞·àò·àà·à∞ ·å•·à≠·àô·ãù:</strong> ${stats.pending_bottles}</div>
                            </div>
                        </div>
                    `;
                }
            } catch (error) {
                reportContent.innerHTML = '<div class="error">·à™·çñ·à≠·âµ ·ä≠·àò·åΩ·ä• ·ä£·ã≠·ä®·ä£·àà·äï·ç¢</div>';
            }
        }
        
        // Close modal when clicking outside
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }
    </script>
</body>
</html>